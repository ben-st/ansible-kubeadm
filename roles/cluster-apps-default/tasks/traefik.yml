- name: copy files
  copy:
    src: traefik/
    dest: /tmp/cluster-install/traefik/

# helm template
- name: helm template traefik
  shell: |
    helm template \
      --name traefik --namespace kube-system \
      /tmp/cluster-install/charts/stable/traefik \
      -f /tmp/cluster-install/traefik/values.yml \
      > /tmp/cluster-install/traefik/traefik-templated.yml
  args:
    executable: /bin/bash

# deploy traefik
- name: kubectl apply /tmp/cluster-install/traefik/traefik-templated.yml
  shell: "kubectl apply -f /tmp/cluster-install/traefik/traefik-templated.yml"

#- name: install traefik as an ingress controller on port 80
 # shell: kubectl apply -f https://raw.githubusercontent.com/containous/traefik/v1.7/examples/k8s/traefik-ds.yaml